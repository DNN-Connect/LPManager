NAnt 0.91 (Build 0.91.4312.0; release; 22/10/2011)
Copyright (C) 2001-2011 Gerry Shaw
http://nant.sourceforge.net

Buildfile: file:///E:/Webroot/LEDEV/DesktopModules/DNNEurope/LocalizationEditor/_BuildSupport/CreateScript.build
Target framework: Microsoft .NET Framework 4.0
Target(s) specified: create.script 


create.script:

Loaded E:\Webroot\LEDEV\web.config
ConnectionString: Server=(local);Database=LEDEV;uid=test;pwd=test;
ObjectQualifier : LEDEV_
DatabaseOwner   : dbo
FullPattern     : (?<owner>\[?dbo\]?\.)?\[?(?<prefix>\w*)(?<dnnqualifier>LEDEV_)(?<modqualifier>LocalizationEditor_)(?<name>\w+)\]?|(?<owner>\[?dbo\]?\.)\[?(?<prefix>\w*)(?<dnnqualifier>LEDEV_)(?<modqualifier>LocalizationEditor_)?(?<name>\w+)\]?|\[?(?<dnnqualifier>LEDEV_)(?<name>\w+)\]?

Create Install Script
TABLES
Adding LEDEV_LocalizationEditor_Objects
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Objects]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Objects](
	[ObjectId] [int] IDENTITY(1,1) NOT NULL,
	[ObjectName] [nvarchar](128) NOT NULL,
	[FriendlyName] [nvarchar](128) NOT NULL,
	[InstallPath] [nvarchar](255) NOT NULL,
	[ModuleId] [int] NOT NULL,
	[PackageType] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Objects] PRIMARY KEY CLUSTERED 
(
	[ObjectId] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Packages
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Packages]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Packages](
	[ChildObjectId] [int] NOT NULL,
	[ChildVersion] [varchar](10) NULL,
	[ParentObjectId] [int] NOT NULL,
	[ParentVersion] [varchar](10) NOT NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Packages] PRIMARY KEY CLUSTERED 
(
	[ChildObjectId] ASC,
	[ParentObjectId] ASC,
	[ParentVersion] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_PartnerPacks
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks](
	[LastModified] [datetime] NOT NULL,
	[Locale] [nvarchar](10) NOT NULL,
	[ObjectId] [int] NOT NULL,
	[PartnerId] [int] NOT NULL,
	[PercentComplete] [real] NOT NULL,
	[RemoteObjectId] [int] NOT NULL,
	[Version] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_PartnerPacks] PRIMARY KEY CLUSTERED 
(
	[Locale] ASC,
	[ObjectId] ASC,
	[PartnerId] ASC,
	[Version] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Partners
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Partners]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Partners](
	[AllowDirectDownload] [bit] NOT NULL,
	[ModuleId] [int] NOT NULL,
	[AllowRedistribute] [bit] NOT NULL,
	[CubeUrl] [nvarchar](300) NOT NULL,
	[DownloadAffiliates] [bit] NOT NULL,
	[LastCube] [nvarchar](max) NULL,
	[PackUrl] [nvarchar](300) NULL,
	[PartnerId] [int] IDENTITY(1,1) NOT NULL,
	[PartnerName] [nvarchar](100) NOT NULL,
	[PartnerUrl] [nvarchar](300) NULL,
	[PartnerUsername] [nchar](50) NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Partners] PRIMARY KEY CLUSTERED 
(
	[PartnerId] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Permissions
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Permissions](
	[PermissionId] [int] IDENTITY(1,1) NOT NULL,
	[ModuleId] [int] NOT NULL,
	[UserId] [int] NOT NULL,
	[Locale] [nvarchar](10) NOT NULL,
	[AccessKey] [uniqueidentifier] NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Permissions] PRIMARY KEY CLUSTERED 
(
	[PermissionId] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Statistics
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Statistics](
	[Total] [int] NOT NULL,
	[UserId] [int] NOT NULL,
	[TextId] [int] NOT NULL,
	[Locale] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Statistics] PRIMARY KEY CLUSTERED 
(
	[TextId] ASC,
	[Locale] ASC,
	[UserId] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Texts
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Texts]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Texts](
	[TextId] [int] IDENTITY(1,1) NOT NULL,
	[ObjectId] [int] NOT NULL,
	[Version] [nvarchar](10) NOT NULL,
	[FilePath] [nvarchar](255) NOT NULL,
	[TextKey] [nvarchar](255) NOT NULL,
	[OriginalValue] [nvarchar](max) NULL,
	[DeprecatedIn] [nvarchar](10) NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Texts] PRIMARY KEY CLUSTERED 
(
	[TextId] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


Adding LEDEV_LocalizationEditor_Translations
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Translations]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEDEV_LocalizationEditor_Translations](
	[Locale] [nvarchar](10) NOT NULL,
	[TextId] [int] NOT NULL,
	[TextValue] [nvarchar](max) NULL,
	[LastModified] [datetime] NULL,
	[LastModifiedUserId] [int] NULL,
 CONSTRAINT [PK_LEDEV_LocalizationEditor_Translations] PRIMARY KEY CLUSTERED 
(
	[TextId] ASC,
	[Locale] ASC
)WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF)
)
END
GO


STRUCTURE
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Packages_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Packages]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Packages]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Packages_Objects] FOREIGN KEY([ParentObjectId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Objects] ([ObjectId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Packages_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Packages]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Packages] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Packages_Objects]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Objects] FOREIGN KEY([ObjectId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Objects] ([ObjectId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Objects]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Partners]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Partners] FOREIGN KEY([PartnerId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Partners] ([PartnerId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Partners]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Partners]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Partners_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Partners]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Partners]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Partners_Modules] FOREIGN KEY([ModuleId])
REFERENCES [dbo].[LEDEV_Modules] ([ModuleID])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Partners_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Partners]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Partners] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Partners_Modules]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions]  WITH CHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Modules] FOREIGN KEY([ModuleId])
REFERENCES [dbo].[LEDEV_Modules] ([ModuleID])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Modules]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions]  WITH CHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Users] FOREIGN KEY([UserId])
REFERENCES [dbo].[LEDEV_Users] ([UserID])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Users]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Texts] FOREIGN KEY([TextId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Texts] ([TextId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Texts]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Users] FOREIGN KEY([UserId])
REFERENCES [dbo].[LEDEV_Users] ([UserID])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Users]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Texts_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Texts]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Texts]  WITH NOCHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Texts_Objects] FOREIGN KEY([ObjectId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Objects] ([ObjectId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Texts_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Texts]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Texts] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Texts_Objects]
GO


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Translations_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Translations]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Translations]  WITH CHECK ADD  CONSTRAINT [FK_LEDEV_LocalizationEditor_Translations_Texts] FOREIGN KEY([TextId])
REFERENCES [dbo].[LEDEV_LocalizationEditor_Texts] ([TextId])
ON DELETE CASCADE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Translations_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Translations]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Translations] CHECK CONSTRAINT [FK_LEDEV_LocalizationEditor_Translations_Texts]
GO


TRIGGERS
VIEWS
Adding LEDEV_vw_LocalizationEditor_Objects
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_Objects]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_Objects]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE VIEW dbo.LEDEV_vw_LocalizationEditor_Objects
AS
SELECT
 o.ObjectId, 
 o.ObjectName, 
 o.FriendlyName, 
 o.InstallPath, 
 o.ModuleId, 
 o.PackageType, 
 MAX(ISNULL(t.Version, '00.00.00')) AS LastVersion, 
 '00.00.00' AS Version,
 COUNT(t.TextId) AS LastVersionTextCount,
 MAX(ISNULL(p.ParentVersion, '00.00.00')) AS LastPackVersion
FROM dbo.LEDEV_LocalizationEditor_Objects o
 LEFT OUTER JOIN dbo.LEDEV_LocalizationEditor_Packages AS p ON o.ObjectId = p.ParentObjectId
 LEFT OUTER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON o.ObjectId = t.ObjectId AND NOT (t.OriginalValue IS NULL OR t.OriginalValue='')
GROUP BY o.ObjectId, o.ObjectName, o.FriendlyName, o.InstallPath, o.ModuleId, o.PackageType, t.DeprecatedIn
HAVING t.DeprecatedIn IS NULL


GO


Adding LEDEV_vw_LocalizationEditor_ObjectVersions
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_ObjectVersions]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_ObjectVersions]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE VIEW dbo.LEDEV_vw_LocalizationEditor_ObjectVersions
AS
SELECT
 o.*,
 texts.Version,
 texts.NewTexts,
 texts.TotalTexts
FROM dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN
(SELECT
 t1.ObjectId,
 t1.Version,
 count(t1.textid) as NewTexts,
(SELECT count (t3.textid) FROM dbo.LEDEV_LocalizationEditor_Texts t3
 WHERE t3.objectid=t1.objectid
  AND t3.version <= t1.version
  AND isnull(t3.deprecatedin, '99.99.99') > t1.version) TotalTexts
FROM dbo.LEDEV_LocalizationEditor_Texts t1
GROUP BY t1.ObjectId, t1.Version) texts ON texts.ObjectId=o.ObjectId
GO


Adding LEDEV_vw_LocalizationEditor_Permissions
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_Permissions]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_Permissions]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE VIEW dbo.LEDEV_vw_LocalizationEditor_Permissions
AS
SELECT        p.PermissionId, p.ModuleId, p.UserId, p.Locale, p.AccessKey, u.DisplayName, u.Username
FROM            dbo.LEDEV_LocalizationEditor_Permissions AS p INNER JOIN
                         dbo.LEDEV_Users AS u ON p.UserId = u.UserID

GO


FUNCTIONS
Adding LEDEV_LocalizationEditor_GetTranslationStatus
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationStatus]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[LEDEV_LocalizationEditor_GetTranslationStatus]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE FUNCTION dbo.[LEDEV_LocalizationEditor_GetTranslationStatus]
(
 @ObjectId Int,
 @Version VarChar(10),
 @Locale VarChar(10)
)
RETURNS INT

AS
BEGIN

DECLARE @LocShort VARCHAR(10)
SET @LocShort=LEFT(@Locale,2);
DECLARE @TextCount INT;
DECLARE @TransCount INT;

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT @TextCount = COUNT(x.TextId), @TransCount= COUNT(x.LocCount) FROM
(SELECT ao.ObjectId, t.TextId, MAX(tr.Locale) LocCount
FROM AllObjects ao
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Texts t ON ao.ObjectId=t.ObjectId AND ISNULL(t.DeprecatedIn, '99.99.99') > ao.[Version]
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON tr.TextId=t.TextId AND (tr.Locale=@Locale OR tr.Locale=@LocShort)
GROUP BY ao.ObjectId, t.TextId) AS x;

IF @TextCount=0
 SET @TextCount=1;

RETURN CAST(100 * @TransCount/@TextCount AS INT);

END

GO


SPROCS
Adding LEDEV_LocalizationEditor_AddObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_AddObject]
 @FriendlyName NVARCHAR (128), 
 @ModuleId INT, 
 @InstallPath NVARCHAR (255), 
 @ObjectName NVARCHAR (128), 
 @PackageType NVARCHAR (100)
AS

INSERT INTO dbo.LEDEV_LocalizationEditor_Objects (
 [FriendlyName],
 [ModuleId],
 [InstallPath],
 [ObjectName],
 [PackageType]
)
 VALUES ( @FriendlyName, @ModuleId, @InstallPath, @ObjectName, @PackageType)

select SCOPE_IDENTITY()


GO


Adding LEDEV_LocalizationEditor_AddPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_AddPartner]
 @AllowDirectDownload BIT, 
 @ModuleId INT, 
 @AllowRedistribute BIT, 
 @CubeUrl NVARCHAR (300), 
 @DownloadAffiliates BIT, 
 @LastCube NVARCHAR (MAX), 
 @PackUrl NVARCHAR (300), 
 @PartnerName NVARCHAR (100), 
 @PartnerUrl NVARCHAR (300), 
 @PartnerUsername NCHAR (50)
AS

INSERT INTO dbo.LEDEV_LocalizationEditor_Partners (
 [AllowDirectDownload],
 [ModuleId],
 [AllowRedistribute],
 [CubeUrl],
 [DownloadAffiliates],
 [LastCube],
 [PackUrl],
 [PartnerName],
 [PartnerUrl],
 [PartnerUsername]
)
 VALUES ( @AllowDirectDownload, @ModuleId, @AllowRedistribute, @CubeUrl, @DownloadAffiliates, @LastCube, @PackUrl, @PartnerName, @PartnerUrl, @PartnerUsername)


select SCOPE_IDENTITY()


GO


Adding LEDEV_LocalizationEditor_AddPartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPartnerPack]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPartnerPack]
 @LastModified DATETIME, 
 @Locale NVARCHAR(10), 
 @ObjectId INT, 
 @PartnerId INT, 
 @PercentComplete REAL, 
 @RemoteObjectId INT, 
 @Version NVARCHAR(10)

AS

INSERT INTO dbo.LEDEV_LocalizationEditor_PartnerPacks (
 [LastModified],
 [Locale],
 [ObjectId],
 [PartnerId],
 [PercentComplete],
 [RemoteObjectId],
 [Version])
VALUES (
 @LastModified,
 @Locale,
 @ObjectId,
 @PartnerId,
 @PercentComplete,
 @RemoteObjectId,
 @Version)



GO


Adding LEDEV_LocalizationEditor_AddPermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPermission]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPermission]
 @ModuleId INT, 
 @Locale NVARCHAR (10), 
 @UserId INT
AS

INSERT INTO dbo.LEDEV_LocalizationEditor_Permissions (
 [ModuleId],
 [Locale],
 [UserId],
 [AccessKey]
)
 VALUES ( @ModuleId, @Locale, @UserId, NEWID())


select SCOPE_IDENTITY()


GO


Adding LEDEV_LocalizationEditor_AddText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_AddText]
 @DeprecatedIn NVARCHAR (10), 
 @FilePath NVARCHAR (255), 
 @ObjectId INT, 
 @OriginalValue NVARCHAR (MAX), 
 @TextKey NVARCHAR (255), 
 @Version NVARCHAR (10)
AS

INSERT INTO dbo.LEDEV_LocalizationEditor_Texts (
 [DeprecatedIn],
 [FilePath],
 [ObjectId],
 [OriginalValue],
 [TextKey],
 [Version]
)
 VALUES ( @DeprecatedIn, @FilePath, @ObjectId, @OriginalValue, @TextKey, @Version)


select SCOPE_IDENTITY()


GO


Adding LEDEV_LocalizationEditor_CurrentVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_CurrentVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_CurrentVersion]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_CurrentVersion]
    @ObjectId Int,
    @Locale NVarChar(10)
AS 
    IF @Locale = '' 
        BEGIN
            SELECT  MAX(t.[Version]) MaxVersion
            FROM    dbo.LEDEV_LocalizationEditor_Texts t
            WHERE   t.[ObjectId] = @ObjectId
        END
    ELSE 
        BEGIN
            SELECT  MAX(t.[Version]) MaxVersion
            FROM    dbo.LEDEV_LocalizationEditor_Texts t
                    INNER JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId
                                                                            AND trans.Locale = @Locale
            WHERE   t.[ObjectId] = @ObjectId
        END




GO


Adding LEDEV_LocalizationEditor_DeleteObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeleteObject] @ObjectId int
AS 
    DELETE  FROM dbo.LEDEV_LocalizationEditor_Objects
    WHERE   ObjectId = @ObjectId




GO


Adding LEDEV_LocalizationEditor_DeletePartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeletePartner]
 @PartnerId INT
AS

DELETE FROM dbo.LEDEV_LocalizationEditor_Partners
WHERE
 [PartnerId] = @PartnerId


GO


Adding LEDEV_LocalizationEditor_DeletePartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPack]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPack]
 @PartnerId INT,
 @ObjectId INT,
 @Version NVARCHAR(10),
 @Locale NVARCHAR(10)
AS

DELETE FROM dbo.LEDEV_LocalizationEditor_PartnerPacks
WHERE
 [PartnerId] = @PartnerId
 AND [ObjectId] = @ObjectId
 AND [Version] = @Version
 AND [Locale] = @Locale


GO


Adding LEDEV_LocalizationEditor_DeletePartnerPacksByPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartnerPacksByPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPacksByPartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPacksByPartner]
 @PartnerId INT
AS

DELETE FROM dbo.LEDEV_LocalizationEditor_PartnerPacks
WHERE
 [PartnerId] = @PartnerId

GO


Adding LEDEV_LocalizationEditor_DeletePermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePermission]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeletePermission] @PermissionId int
AS 
    DELETE  FROM dbo.LEDEV_LocalizationEditor_Permissions
    WHERE   PermissionId = @PermissionId




GO


Adding LEDEV_LocalizationEditor_DeleteStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteStatistic]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeleteStatistic]
 @TextId INT,
 @Locale NVARCHAR (10),
 @UserId INT
AS

DELETE FROM dbo.LEDEV_LocalizationEditor_Statistics
WHERE
 [TextId] = @TextId
 AND [Locale] = @Locale
 AND [UserId] = @UserId


GO


Adding LEDEV_LocalizationEditor_DeleteText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeleteText] @TextId Int
AS 
    DELETE  FROM dbo.LEDEV_LocalizationEditor_Texts
    WHERE   [TextId] = @TextId




GO


Adding LEDEV_LocalizationEditor_DeleteTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteTranslation]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_DeleteTranslation]
 @TextId INT,
 @Locale NVARCHAR (10)
AS

DELETE FROM dbo.LEDEV_LocalizationEditor_Translations
WHERE
 [TextId] = @TextId
 AND [Locale] = @Locale


GO


Adding LEDEV_LocalizationEditor_FindText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_FindText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_FindText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_FindText]
    @ObjectId Int,
    @FilePath NVarChar(255),
    @Locale NVarChar(10),
    @Version NVarChar(10),
    @TextKey NVarChar(255)
AS 
    SELECT  t.*,
            trans.Locale,
            trans.TextValue
    FROM    dbo.LEDEV_LocalizationEditor_Texts t
            LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId
                                                                   AND trans.Locale = @Locale
    WHERE   t.[ObjectId] = @ObjectId
            AND t.[FilePath] = @FilePath
            AND t.[Version] = @Version
            AND t.[TextKey] = @TextKey




GO


Adding LEDEV_LocalizationEditor_GetAllPartners
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetAllPartners]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetAllPartners]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetAllPartners]
AS

SELECT p.* 
FROM dbo.LEDEV_LocalizationEditor_Partners p



GO


Adding LEDEV_LocalizationEditor_GetContributorList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetContributorList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetContributorList]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetContributorList
 @ObjectId INT,
 @Version VARCHAR(10),
 @Locale VARCHAR(10)
AS

DECLARE @LocShort VARCHAR(10)
SET @LocShort=LEFT(@Locale,2);

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT
 u.*
FROM
 dbo.LEDEV_vw_Users u
 INNER JOIN 
(SELECT
 s.UserId, SUM(s.Total) Total
FROM
 AllObjects ao
 INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.ObjectId=ao.ObjectId
 INNER JOIN dbo.LEDEV_LocalizationEditor_Statistics s ON s.TextId=t.TextId AND (s.Locale=@Locale OR s.Locale=@LocShort)
GROUP BY s.UserId) AS stats ON stats.UserId=u.UserId
ORDER BY stats.Total DESC


GO


Adding LEDEV_LocalizationEditor_GetCube
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetCube]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetCube]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetCube
 @ModuleId int
AS 

SELECT
 *,
 (SELECT COUNT(TextId) Translated
  FROM
   (SELECT
     tr.TextId
    FROM dbo.LEDEV_LocalizationEditor_Translations tr
     INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.TextId=tr.TextId
    WHERE t.ObjectId=o.ObjectId
     AND (tr.Locale=locales.Locale OR tr.Locale=LEFT(locales.Locale,2))
     AND t.version <= o.Version
     AND ISNULL(t.deprecatedin, '99.99.99') > o.Version
	GROUP BY tr.TextId) trs) AS TotalTranslated,
 (SELECT MAX(LastModified)
  FROM
   (SELECT
     MAX(tr.LastModified) LastModified
    FROM dbo.LEDEV_LocalizationEditor_Translations tr
     INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.TextId=tr.TextId
    WHERE t.ObjectId=o.ObjectId
     AND (tr.Locale=locales.Locale OR tr.Locale=LEFT(locales.Locale,2))
     AND t.version <= o.Version
     AND ISNULL(t.deprecatedin, '99.99.99') > o.Version) trs) AS LastModified
FROM dbo.LEDEV_vw_LocalizationEditor_ObjectVersions o
 INNER JOIN
 (SELECT DISTINCT
   tr.Locale, t.ObjectId
  FROM dbo.LEDEV_LocalizationEditor_Translations tr
   INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.TextId=tr.TextId) locales ON locales.ObjectId=o.ObjectId
WHERE
 o.ModuleId = @ModuleId
ORDER BY
 o.ObjectId, o.Version


GO


Adding LEDEV_LocalizationEditor_GetDependentTextsForObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetDependentTextsForObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetDependentTextsForObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetDependentTextsForObject]
 @ModuleId Int,
 @ParentObjectId Int,
 @FilePath NVarChar(255),
 @Locale VarChar(10),
 @Version VarChar(10),
 @IncludeNonTranslated BIT
AS 

DECLARE @Locale2 VarChar(2)
SET @Locale2 = LEFT(@Locale, 2);

IF @ModuleId=-1
SET @ModuleId = (SELECT ModuleId FROM dbo.LEDEV_LocalizationEditor_Objects WHERE ObjectId=@ParentObjectId);

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version [Version]
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ParentObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT  t.*,
 ISNULL(trans.Locale, trans2.Locale) AS Locale,
 ISNULL(trans.TextValue, trans2.TextValue) AS TextValue,
 ISNULL(trans.LastModified, trans2.LastModified) AS LastModified,
 ISNULL(trans.LastModifiedUserId, trans2.LastModifiedUserId) AS LastModifiedUserId
FROM AllObjects ao
 INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.ObjectId=ao.ObjectId
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId AND trans.Locale = @Locale
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans2 ON t.TextId = trans2.TextId AND trans2.Locale = @Locale2
WHERE t.[FilePath] = @FilePath
 AND ISNULL(t.DeprecatedIn, '99.99.99') > ao.Version
 AND t.Version <= ao.Version
  AND NOT (trans.TextValue IS NULL
  AND trans2.TextValue IS NULL
  AND @IncludeNonTranslated = 0)
GO


Adding LEDEV_LocalizationEditor_GetFiles
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetFiles]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetFiles]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetFiles]
    @ObjectId Int,
    @Version NVarChar(10)
AS 
    SELECT DISTINCT
            t.FilePath
    FROM    dbo.LEDEV_LocalizationEditor_Texts t
            INNER JOIN ( SELECT FilePath,
                                TextKey,
                                MAX([Version]) MaxVersion
                         FROM   dbo.LEDEV_LocalizationEditor_Texts
                         WHERE  [ObjectId] = @ObjectId
                                AND Version <= @Version
                                AND ( DeprecatedIn IS NULL
                                      OR DeprecatedIn > @Version
                                    )
                         GROUP BY FilePath,
                                TextKey
                       ) lv ON lv.FilePath = t.FilePath
                               AND lv.TextKey = t.TextKey
                               AND lv.MaxVersion = t.[Version]
    WHERE   t.ObjectId = @ObjectId
    ORDER BY t.FilePath




GO


Adding LEDEV_LocalizationEditor_GetFrameworkVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetFrameworkVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetFrameworkVersion]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetFrameworkVersion]
AS 
    SELECT TOP 1
            Major,
            Minor,
            Build
    FROM    dbo.Version
    ORDER BY CreatedDate DESC




GO


Adding LEDEV_LocalizationEditor_GetLanguagePacks
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLanguagePacks]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLanguagePacks]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLanguagePacks]
 @ObjectId Int,
 @Version VarChar(10)
AS

DECLARE @ResultSet table (SelectedValue int)
INSERT INTO @ResultSet (SelectedValue)
 EXEC dbo.LEDEV_LocalizationEditor_NrOfItems @objectId, @Version;
    
DECLARE @TotalTexts INT
SET @TotalTexts = (SELECT TOP 1 SelectedValue FROM @ResultSet);

IF @TotalTexts=0
 SET @TotalTexts=1;

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version [Version]
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT
 -1 PartnerId,'' PartnerName,'' PartnerUrl,'' PackUrl,
 tr.Locale,-1 RemoteObjectId,
 100*COUNT(tr.Locale)/@TotalTexts PercentComplete,
 MAX(tr.LastModified) LastModified
FROM
 (SELECT t.TextId
  FROM dbo.LEDEV_LocalizationEditor_Texts t
  INNER JOIN AllObjects ON AllObjects.ObjectId=t.ObjectId
  WHERE
   t.Version <= AllObjects.[Version]
   AND ISNULL(t.DeprecatedIn,'99.99.99')>AllObjects.[Version]) texts
 INNER JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON texts.TextId=tr.TextId
GROUP BY tr.Locale

UNION

SELECT
 p.PartnerId,
 p.PartnerName,
 p.PartnerUrl,
 p.PackUrl,
 pp.Locale,
 pp.RemoteObjectId,
 pp.PercentComplete,
 pp.LastModified
FROM dbo.LEDEV_LocalizationEditor_PartnerPacks pp
 INNER JOIN dbo.LEDEV_LocalizationEditor_Partners p ON pp.PartnerId=p.PartnerId
WHERE pp.ObjectId=@ObjectId
 AND pp.Version=@Version

ORDER BY Locale


GO


Adding LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale]
 @ObjectId INT,
 @Version VARCHAR(10),
 @Locale VARCHAR(10)
AS

SELECT
 -1 PartnerId,'' PartnerName,'' PartnerUrl,'' PackUrl,-1 RemoteObjectId,
 100*COUNT(lst.Locale)/COUNT(lst.TextId) PercentComplete,
 MAX(lst.LastModified) LastModified
FROM
 (SELECT t.TextId, tr.Locale, tr.LastModified
  FROM dbo.LEDEV_LocalizationEditor_Texts t
   LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON t.TextId=tr.TextId 
    AND (tr.Locale=@Locale OR LEFT(tr.Locale,2)=LEFT(@Locale,2))
  WHERE
   t.ObjectId=@ObjectId 
   AND t.Version <= @Version
   AND ISNULL(t.OriginalValue,'') <> ''
   AND ISNULL(t.DeprecatedIn,'99.99.99')>@Version) lst

UNION

SELECT
 p.PartnerId,
 p.PartnerName,
 p.PartnerUrl,
 p.PackUrl,
 pp.RemoteObjectId,
 pp.PercentComplete,
 pp.LastModified
FROM dbo.LEDEV_LocalizationEditor_PartnerPacks pp
 INNER JOIN dbo.LEDEV_LocalizationEditor_Partners p ON pp.PartnerId=p.PartnerId
WHERE pp.ObjectId=@ObjectId
 AND pp.Locale=@Locale
 AND pp.Version=@Version



GO


Adding LEDEV_LocalizationEditor_GetLastEditTime
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLastEditTime]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLastEditTime]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLastEditTime]
    @ObjectId Int,
    @Locale NVarChar(10),
    @Version NVarChar(10)
AS 
    DECLARE @Locale2 VarChar(2)
    SET @Locale2 = LEFT(@Locale, 2)

    SELECT  MAX(ISNULL(trans.LastModified, trans2.LastModified))
    FROM    dbo.LEDEV_LocalizationEditor_Texts t
            LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId
                                                                   AND trans.Locale = @Locale
            LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans2 ON t.TextId = trans2.TextId
                                                                    AND trans2.Locale = @Locale2
            INNER JOIN ( SELECT FilePath,
                                TextKey,
                                MAX([Version]) MaxVersion
                         FROM   dbo.LEDEV_LocalizationEditor_Texts
                         WHERE  [ObjectId] = @ObjectId
                                AND Version <= @Version
                                AND ( DeprecatedIn IS NULL
                                      OR DeprecatedIn > @Version
                                    )
                         GROUP BY FilePath,
                                TextKey
                       ) lv ON lv.FilePath = t.FilePath
                               AND lv.TextKey = t.TextKey
                               AND lv.MaxVersion = t.[Version]
    WHERE   t.ObjectId = @ObjectId
            AND NOT ( trans.TextValue IS NULL
                      AND trans2.TextValue IS NULL
                    )




GO


Adding LEDEV_LocalizationEditor_GetLatestText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLatestText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLatestText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLatestText]
 @ObjectId Int,
 @FilePath NVarChar(255),
 @Locale NVarChar(10),
 @TextKey NVarChar(255)
AS 
 SELECT  t.*,
 trans.Locale,
 trans.TextValue,
 trans.LastModified,
 trans.LastModifiedUserId
 FROM dbo.LEDEV_LocalizationEditor_Texts t
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId
  AND trans.Locale = @Locale
 INNER JOIN 
  (SELECT FilePath, TextKey, MAX([Version]) MaxVersion
    FROM dbo.LEDEV_LocalizationEditor_Texts
    WHERE  [ObjectId] = @ObjectId
    GROUP BY FilePath, TextKey) lv ON lv.FilePath = t.FilePath AND lv.TextKey = t.TextKey AND lv.MaxVersion = t.[Version]
 WHERE t.ObjectId = @ObjectId
 AND t.TextKey = @TextKey
 AND t.FilePath = @FilePath
GO


Adding LEDEV_LocalizationEditor_GetLocales
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLocales]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLocales]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLocales]
 @ModuleId Int
AS

SELECT DISTINCT tr.Locale
FROM dbo.LEDEV_LocalizationEditor_Translations tr
INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.TextId=tr.TextId
INNER JOIN dbo.LEDEV_LocalizationEditor_Objects o ON t.ObjectId=o.ObjectId AND o.ModuleId=@ModuleId
ORDER BY tr.Locale


GO


Adding LEDEV_LocalizationEditor_GetLocalesForUser
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLocalesForUser]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLocalesForUser]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetLocalesForUser]
    @UserID INT,
    @PortalID INT,
    @ModuleID INT
AS

-- Determine if user is an administrator or host
DECLARE @isAdmin BIT
IF @UserID = ( SELECT   AdministratorId
               FROM     dbo.[LEDEV_Portals]
               WHERE    PortalID = @PortalID
             )
    OR ( SELECT IsSuperUser
         FROM   dbo.[LEDEV_Users]
         WHERE  UserID = @UserID
       ) = 1 
    SET @isAdmin = 1

SELECT DISTINCT P.ModuleId, P.Locale
FROM dbo.[LEDEV_LocalizationEditor_Permissions] P
WHERE (P.UserId=@UserId OR @isAdmin=1)
 AND P.ModuleId=@ModuleId



GO


Adding LEDEV_LocalizationEditor_GetModuleForObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetModuleForObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetModuleForObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetModuleForObject]
 @ObjectId Int
AS 

SELECT 
 m.ModuleId,
 p.HomeDirectory,
 m1.SettingValue AS OwnerName,
 m2.SettingValue AS OwnerEmail,
 m3.SettingValue AS OwnerOrganization,
 m4.SettingValue AS OwnerUrl,
 m5.SettingValue AS CachePacks,
 m6.SettingValue AS Attribution
FROM dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN dbo.LEDEV_Modules m ON m.ModuleID = o.ModuleID
 INNER JOIN dbo.LEDEV_Portals p ON p.PortalID = m.PortalID
 LEFT JOIN dbo.LEDEV_ModuleSettings m1 ON m1.ModuleID = m.ModuleID AND m1.SettingName='OwnerName'
 LEFT JOIN dbo.LEDEV_ModuleSettings m2 ON m2.ModuleID = m.ModuleID AND m2.SettingName='OwnerEmail'
 LEFT JOIN dbo.LEDEV_ModuleSettings m3 ON m3.ModuleID = m.ModuleID AND m3.SettingName='OwnerOrganization'
 LEFT JOIN dbo.LEDEV_ModuleSettings m4 ON m4.ModuleID = m.ModuleID AND m4.SettingName='OwnerUrl'
 LEFT JOIN dbo.LEDEV_ModuleSettings m5 ON m5.ModuleID = m.ModuleID AND m5.SettingName='CachePacks'
 LEFT JOIN dbo.LEDEV_ModuleSettings m6 ON m6.ModuleID = m.ModuleID AND m6.SettingName='Attribution'


GO


Adding LEDEV_LocalizationEditor_GetObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObject]
 @ObjectId Int
AS 
 SELECT  *
 FROM dbo.LEDEV_vw_LocalizationEditor_Objects
 WHERE [ObjectId] = @ObjectId


GO


Adding LEDEV_LocalizationEditor_GetObjectByObjectName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectByObjectName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectByObjectName]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectByObjectName]
 @ModuleId INT,
 @ObjectName NVARCHAR(128)
AS 

SELECT *
FROM dbo.LEDEV_vw_LocalizationEditor_Objects
WHERE ModuleId=@ModuleId
 AND ObjectName = @ObjectName



GO


Adding LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey]
 @PortalId INT,
 @ObjectName NVARCHAR(100),
 @ModuleKey NVARCHAR(100)
AS

SELECT o.*
FROM dbo.LEDEV_vw_LocalizationEditor_Objects o
 INNER JOIN dbo.LEDEV_ModuleSettings ms ON o.ModuleId=ms.ModuleId
 INNER JOIN dbo.LEDEV_Modules m ON m.ModuleId=o.ModuleId
WHERE ms.SettingName='ModuleKey'
 AND ms.SettingValue=@ModuleKey
 AND o.ObjectName=@ObjectName
 AND m.PortalId=@PortalId



GO


Adding LEDEV_LocalizationEditor_GetObjectPackList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectPackList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectPackList]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectPackList]
 @ObjectId Int,
 @Version VarChar(10)
AS

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT
 o.*,
 ao.[Version],
 '' LastVersion
FROM
 dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN AllObjects ao ON o.ObjectId=ao.ObjectId


GO


Adding LEDEV_LocalizationEditor_GetObjects
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjects]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjects]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjects]
 @ModuleID INT
AS 

SELECT
 o.*
FROM
 dbo.LEDEV_vw_LocalizationEditor_Objects o
WHERE o.ModuleId = @ModuleID
ORDER BY o.FriendlyName


GO


Adding LEDEV_LocalizationEditor_GetObjectsByObjectName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsByObjectName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsByObjectName]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectsByObjectName]
 @ObjectName NVARCHAR(128)
AS 

SELECT *
FROM dbo.LEDEV_vw_LocalizationEditor_Objects
WHERE ObjectName = @ObjectName



GO


Adding LEDEV_LocalizationEditor_GetObjectsByPackage
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsByPackage]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsByPackage]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectsByPackage]
 @PackageId INT,
 @PackageVersion NVARCHAR(10)
AS

SELECT
 o.*,
 p.ChildVersion Version,
 '' LastVersion
FROM
 dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN dbo.LEDEV_LocalizationEditor_Packages p ON o.ObjectId=p.ChildObjectId
WHERE
 p.ParentObjectId = @PackageId
 AND p.ParentVersion = @PackageVersion

GO


Adding LEDEV_LocalizationEditor_GetObjectsWithStatus
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsWithStatus]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsWithStatus]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetObjectsWithStatus]
 @ModuleId INT,
 @Locale VARCHAR(10)
AS

DECLARE @LocShort VARCHAR(10)
SET @LocShort = LEFT(@Locale,2)

SELECT 
 o.ObjectId, 
 o.ObjectName, 
 o.FriendlyName, 
 o.InstallPath, 
 o.ModuleId, 
 o.PackageType, 
 o.LastVersion,
 o.LastPackVersion,
 o.LastVersionTextCount, 
 COUNT(tr.TextId) TextCount,
 COUNT(p.ParentObjectId) ChildCount,
 dbo.LEDEV_LocalizationEditor_GetTranslationStatus(o.ObjectId, CASE WHEN (o.LastPackVersion='00.00.00') THEN o.LastVersion ELSE o.LastPackVersion END, @Locale) PercentComplete
FROM dbo.LEDEV_vw_LocalizationEditor_Objects o
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Texts t ON o.ObjectId=t.ObjectId AND (t.DeprecatedIn IS NULL) AND NOT (t.OriginalValue IS NULL OR t.OriginalValue='')
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON tr.TextId=t.TextId AND (tr.Locale=@Locale OR tr.Locale=@LocShort)
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Packages p ON p.ParentObjectId=o.ObjectId AND (p.ParentVersion=o.LastPackVersion OR p.ParentVersion=o.LastVersion)
GROUP BY o.ObjectId, o.ObjectName, o.FriendlyName, o.InstallPath, o.ModuleId, o.PackageType, o.LastVersion, o.LastPackVersion, o.LastVersionTextCount
HAVING o.ModuleId=@ModuleId
ORDER BY o.FriendlyName


GO


Adding LEDEV_LocalizationEditor_GetObjectVersionList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectVersionList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectVersionList]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetObjectVersionList
 @ObjectId Int,
 @Locale VarChar(10)
AS

SELECT @ObjectId AS ObjectId, x.[Version], dbo.LEDEV_LocalizationEditor_GetTranslationStatus(@ObjectId, x.[Version], @Locale) AS PercentComplete
FROM
 (SELECT DISTINCT ov.[Version] FROM
  (SELECT t.[Version]
   FROM dbo.LEDEV_LocalizationEditor_Texts t
   WHERE t.ObjectId=@ObjectId
   UNION ALL
   SELECT p.ParentVersion
   FROM dbo.LEDEV_LocalizationEditor_Packages p
   WHERE p.ParentObjectId=@ObjectId) ov) x
ORDER BY x.Version DESC


GO


Adding LEDEV_LocalizationEditor_GetOldestText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetOldestText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetOldestText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetOldestText]
 @ObjectId INT,
 @FilePath NVARCHAR(255),
 @TextKey NVARCHAR(255)
AS

SELECT
 t.*,
 '' Locale, '' TextValue
FROM dbo.LEDEV_LocalizationEditor_Texts t
 INNER JOIN 
 (SELECT MIN(t2.[Version]) MinVersion
  FROM dbo.LEDEV_LocalizationEditor_Texts t2
  GROUP BY t2.ObjectId, t2.FilePath, t2.TextKey
  HAVING
   t2.ObjectId=@ObjectId
   AND t2.FilePath=@FilePath
   AND t2.TextKey=@TextKey) x ON x.MinVersion=t.Version
WHERE
 t.ObjectId=@ObjectId
 AND t.FilePath=@FilePath
 AND t.TextKey=@TextKey


GO


Adding LEDEV_LocalizationEditor_GetPackStatistics
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPackStatistics]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPackStatistics]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPackStatistics]
 @ObjectId INT,
 @Version NVarChar(10),
 @Locale NVarChar(10)
AS

SELECT SUM(s.Total) AS Total, u.Username
FROM dbo.LEDEV_LocalizationEditor_Statistics s
 INNER JOIN dbo.LEDEV_Users u ON u.UserId=s.userId
 INNER JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON tr.TextId=s.TextId AND tr.Locale=@Locale
 INNER JOIN dbo.LEDEV_LocalizationEditor_Texts t ON t.TextId=tr.TextId
GROUP BY u.Username, t.ObjectId, t.Version, tr.Locale
HAVING
 t.ObjectId = @ObjectId
 AND t.Version = @Version
 AND tr.Locale=@Locale


GO


Adding LEDEV_LocalizationEditor_GetParentObjects
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetParentObjects]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetParentObjects]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetParentObjects
 @ObjectId INT,
 @Version VARCHAR(10)
AS

SELECT
 o.*,
 p.[ParentVersion] AS Version,
 '' LastVersion
FROM
 dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN dbo.LEDEV_LocalizationEditor_Packages p ON p.ParentObjectId=o.ObjectId
WHERE
 p.ChildObjectId=@ObjectId
 AND p.ChildVersion=@Version


GO


Adding LEDEV_LocalizationEditor_GetPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPartner]
 @PartnerId INT
AS

SELECT
 *
FROM
 dbo.LEDEV_LocalizationEditor_Partners
WHERE
 [PartnerId] = @PartnerId


GO


Adding LEDEV_LocalizationEditor_GetPartnerByName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerByName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerByName]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPartnerByName]
 @ModuleId INT,
 @PartnerName NVARCHAR(100)
AS

SELECT p.* 
FROM dbo.LEDEV_LocalizationEditor_Partners p
WHERE
 p.ModuleId=@ModuleId
 AND p.PartnerName=@PartnerName



GO


Adding LEDEV_LocalizationEditor_GetPartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPack]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetPartnerPack
 @PartnerId INT,
 @ObjectId INT,
 @Version NVARCHAR(10),
 @Locale NVARCHAR(10)
AS
SELECT
 *
FROM
 dbo.LEDEV_LocalizationEditor_PartnerPacks
WHERE
 [PartnerId] = @PartnerId
 AND [ObjectId] = @ObjectId
 AND [Version] = @Version
 AND [Locale] = @Locale

GO


Adding LEDEV_LocalizationEditor_GetPartnerPacksByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPartnerPacksByObject]
 @ObjectId INT,
 @StartRowIndex INT = -1,
 @MaximumRows INT = 0,
 @OrderBy VARCHAR(100) = ''
AS

SELECT * FROM
(SELECT
 pp.*,
 ROW_NUMBER() OVER
 (ORDER BY
  CASE @OrderBy WHEN 'LASTMODIFIED DESC' THEN pp.[LastModified] END DESC,
  CASE @OrderBy WHEN 'LASTMODIFIED' THEN pp.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LASTMODIFIED ASC' THEN pp.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LOCALE DESC' THEN pp.[Locale] END DESC,
  CASE @OrderBy WHEN 'LOCALE' THEN pp.[Locale] END ASC,
  CASE @OrderBy WHEN 'LOCALE ASC' THEN pp.[Locale] END ASC,
  CASE @OrderBy WHEN 'OBJECTID DESC' THEN pp.[ObjectId] END DESC,
  CASE @OrderBy WHEN 'OBJECTID' THEN pp.[ObjectId] END ASC,
  CASE @OrderBy WHEN 'OBJECTID ASC' THEN pp.[ObjectId] END ASC,
  CASE @OrderBy WHEN 'PARTNERID DESC' THEN pp.[PartnerId] END DESC,
  CASE @OrderBy WHEN 'PARTNERID' THEN pp.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PARTNERID ASC' THEN pp.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE DESC' THEN pp.[PercentComplete] END DESC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE' THEN pp.[PercentComplete] END ASC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE ASC' THEN pp.[PercentComplete] END ASC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID DESC' THEN pp.[RemoteObjectId] END DESC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID' THEN pp.[RemoteObjectId] END ASC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID ASC' THEN pp.[RemoteObjectId] END ASC,
  CASE @OrderBy WHEN 'VERSION DESC' THEN pp.[Version] END DESC,
  CASE @OrderBy WHEN 'VERSION' THEN pp.[Version] END ASC,
  CASE @OrderBy WHEN 'VERSION ASC' THEN pp.[Version] END ASC
) AS RowNum
FROM
 dbo.LEDEV_LocalizationEditor_PartnerPacks pp
WHERE
 pp.ObjectId = @ObjectId) AS Tbl
WHERE ((RowNum BETWEEN @StartRowIndex AND (@MaximumRows + @StartRowIndex - 1)) OR @StartRowIndex = 0)
 OR (@StartRowIndex = -1 AND (RowNum-1) % @MaximumRows = 0)
ORDER BY RowNum ASC



GO


Adding LEDEV_LocalizationEditor_GetPartnerPacksByPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByPartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPartnerPacksByPartner]
 @PartnerId INT,
 @StartRowIndex INT = -1,
 @MaximumRows INT = 0,
 @OrderBy VARCHAR(100) = ''
AS

SELECT * FROM
(SELECT
 pp.*,
 ROW_NUMBER() OVER
 (ORDER BY
  CASE @OrderBy WHEN 'LASTMODIFIED DESC' THEN pp.[LastModified] END DESC,
  CASE @OrderBy WHEN 'LASTMODIFIED' THEN pp.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LASTMODIFIED ASC' THEN pp.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LOCALE DESC' THEN pp.[Locale] END DESC,
  CASE @OrderBy WHEN 'LOCALE' THEN pp.[Locale] END ASC,
  CASE @OrderBy WHEN 'LOCALE ASC' THEN pp.[Locale] END ASC,
  CASE @OrderBy WHEN 'OBJECTID DESC' THEN pp.[ObjectId] END DESC,
  CASE @OrderBy WHEN 'OBJECTID' THEN pp.[ObjectId] END ASC,
  CASE @OrderBy WHEN 'OBJECTID ASC' THEN pp.[ObjectId] END ASC,
  CASE @OrderBy WHEN 'PARTNERID DESC' THEN pp.[PartnerId] END DESC,
  CASE @OrderBy WHEN 'PARTNERID' THEN pp.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PARTNERID ASC' THEN pp.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE DESC' THEN pp.[PercentComplete] END DESC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE' THEN pp.[PercentComplete] END ASC,
  CASE @OrderBy WHEN 'PERCENTCOMPLETE ASC' THEN pp.[PercentComplete] END ASC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID DESC' THEN pp.[RemoteObjectId] END DESC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID' THEN pp.[RemoteObjectId] END ASC,
  CASE @OrderBy WHEN 'REMOTEOBJECTID ASC' THEN pp.[RemoteObjectId] END ASC,
  CASE @OrderBy WHEN 'VERSION DESC' THEN pp.[Version] END DESC,
  CASE @OrderBy WHEN 'VERSION' THEN pp.[Version] END ASC,
  CASE @OrderBy WHEN 'VERSION ASC' THEN pp.[Version] END ASC
) AS RowNum
FROM
 dbo.LEDEV_LocalizationEditor_PartnerPacks pp
WHERE
 pp.PartnerId = @PartnerId) AS Tbl
WHERE ((RowNum BETWEEN @StartRowIndex AND (@MaximumRows + @StartRowIndex - 1)) OR @StartRowIndex = 0)
 OR (@StartRowIndex = -1 AND (RowNum-1) % @MaximumRows = 0)
ORDER BY RowNum ASC



GO


Adding LEDEV_LocalizationEditor_GetPartnersByModule
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnersByModule]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnersByModule]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetPartnersByModule]
 @ModuleId INT,
 @StartRowIndex INT = -1,
 @MaximumRows INT = 0,
 @OrderBy VARCHAR(100) = ''
AS

SELECT * FROM
(SELECT
 p.*,
 ROW_NUMBER() OVER
 (ORDER BY
  CASE @OrderBy WHEN 'ALLOWDIRECTDOWNLOAD DESC' THEN p.[AllowDirectDownload] END DESC,
  CASE @OrderBy WHEN 'ALLOWDIRECTDOWNLOAD' THEN p.[AllowDirectDownload] END ASC,
  CASE @OrderBy WHEN 'ALLOWDIRECTDOWNLOAD ASC' THEN p.[AllowDirectDownload] END ASC,
  CASE @OrderBy WHEN 'MODULEID DESC' THEN p.[ModuleId] END DESC,
  CASE @OrderBy WHEN 'MODULEID' THEN p.[ModuleId] END ASC,
  CASE @OrderBy WHEN 'MODULEID ASC' THEN p.[ModuleId] END ASC,
  CASE @OrderBy WHEN 'ALLOWREDISTRIBUTE DESC' THEN p.[AllowRedistribute] END DESC,
  CASE @OrderBy WHEN 'ALLOWREDISTRIBUTE' THEN p.[AllowRedistribute] END ASC,
  CASE @OrderBy WHEN 'ALLOWREDISTRIBUTE ASC' THEN p.[AllowRedistribute] END ASC,
  CASE @OrderBy WHEN 'CUBEURL DESC' THEN p.[CubeUrl] END DESC,
  CASE @OrderBy WHEN 'CUBEURL' THEN p.[CubeUrl] END ASC,
  CASE @OrderBy WHEN 'CUBEURL ASC' THEN p.[CubeUrl] END ASC,
  CASE @OrderBy WHEN 'DOWNLOADAFFILIATES DESC' THEN p.[DownloadAffiliates] END DESC,
  CASE @OrderBy WHEN 'DOWNLOADAFFILIATES' THEN p.[DownloadAffiliates] END ASC,
  CASE @OrderBy WHEN 'DOWNLOADAFFILIATES ASC' THEN p.[DownloadAffiliates] END ASC,
  CASE @OrderBy WHEN 'LASTCUBE DESC' THEN p.[LastCube] END DESC,
  CASE @OrderBy WHEN 'LASTCUBE' THEN p.[LastCube] END ASC,
  CASE @OrderBy WHEN 'LASTCUBE ASC' THEN p.[LastCube] END ASC,
  CASE @OrderBy WHEN 'PACKURL DESC' THEN p.[PackUrl] END DESC,
  CASE @OrderBy WHEN 'PACKURL' THEN p.[PackUrl] END ASC,
  CASE @OrderBy WHEN 'PACKURL ASC' THEN p.[PackUrl] END ASC,
  CASE @OrderBy WHEN 'PARTNERID DESC' THEN p.[PartnerId] END DESC,
  CASE @OrderBy WHEN 'PARTNERID' THEN p.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PARTNERID ASC' THEN p.[PartnerId] END ASC,
  CASE @OrderBy WHEN 'PARTNERNAME DESC' THEN p.[PartnerName] END DESC,
  CASE @OrderBy WHEN 'PARTNERNAME' THEN p.[PartnerName] END ASC,
  CASE @OrderBy WHEN 'PARTNERNAME ASC' THEN p.[PartnerName] END ASC,
  CASE @OrderBy WHEN 'PARTNERURL DESC' THEN p.[PartnerUrl] END DESC,
  CASE @OrderBy WHEN 'PARTNERURL' THEN p.[PartnerUrl] END ASC,
  CASE @OrderBy WHEN 'PARTNERURL ASC' THEN p.[PartnerUrl] END ASC,
  CASE @OrderBy WHEN 'PARTNERUSERNAME DESC' THEN p.[PartnerUsername] END DESC,
  CASE @OrderBy WHEN 'PARTNERUSERNAME' THEN p.[PartnerUsername] END ASC,
  CASE @OrderBy WHEN 'PARTNERUSERNAME ASC' THEN p.[PartnerUsername] END ASC
) AS RowNum
FROM
 dbo.LEDEV_LocalizationEditor_Partners p
WHERE
 p.ModuleId = @ModuleId) AS Tbl
WHERE ((RowNum BETWEEN @StartRowIndex AND (@MaximumRows + @StartRowIndex - 1)) OR @StartRowIndex = 0)
 OR (@StartRowIndex = -1 AND (RowNum-1) % @MaximumRows = 0)
ORDER BY RowNum ASC



GO


Adding LEDEV_LocalizationEditor_GetPermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermission]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON





CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermission]
    @UserId Int,
    @Locale NVarChar(10),
    @ModuleId int
AS 
    SELECT  *
    FROM    dbo.LEDEV_vw_LocalizationEditor_Permissions
    WHERE   [UserId] = @UserId
            AND [Locale] = @Locale
            AND [ModuleId] = @ModuleId


GO


Adding LEDEV_LocalizationEditor_GetPermissionById
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermissionById]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissionById]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissionById]
    @permissionId INT
AS 
    SELECT  *
    FROM    dbo.LEDEV_vw_LocalizationEditor_Permissions
    WHERE   [PermissionId] = @permissionId


GO


Adding LEDEV_LocalizationEditor_GetPermissions
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermissions]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissions]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON





CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissions] 
 @ModuleId int
AS 
    SELECT  P.*
    FROM    dbo.LEDEV_vw_LocalizationEditor_Permissions P
    WHERE   P.[ModuleId] = @ModuleId
    ORDER BY [DisplayName],
            [Locale],
            [PermissionId]




GO


Adding LEDEV_LocalizationEditor_GetStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetStatistic]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetStatistic]
 @TextId INT,
 @Locale NVARCHAR (10),
 @UserId INT
AS

SELECT
 *
FROM
 dbo.LEDEV_LocalizationEditor_Statistics
WHERE
 [TextId] = @TextId
 AND [Locale] = @Locale
 AND [UserId] = @UserId


GO


Adding LEDEV_LocalizationEditor_GetStatisticsByUser
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetStatisticsByUser]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetStatisticsByUser]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetStatisticsByUser]
 @UserId INT,
 @StartRowIndex INT = -1,
 @MaximumRows INT = 0,
 @OrderBy VARCHAR(100) = ''
AS

SELECT * FROM
(SELECT
 s.*,
 ROW_NUMBER() OVER
 (ORDER BY
  CASE @OrderBy WHEN 'LOCALE DESC' THEN s.[Locale] END DESC,
  CASE @OrderBy WHEN 'LOCALE' THEN s.[Locale] END ASC,
  CASE @OrderBy WHEN 'LOCALE ASC' THEN s.[Locale] END ASC,
  CASE @OrderBy WHEN 'TEXTID DESC' THEN s.[TextId] END DESC,
  CASE @OrderBy WHEN 'TEXTID' THEN s.[TextId] END ASC,
  CASE @OrderBy WHEN 'TEXTID ASC' THEN s.[TextId] END ASC,
  CASE @OrderBy WHEN 'TOTAL DESC' THEN s.[Total] END DESC,
  CASE @OrderBy WHEN 'TOTAL' THEN s.[Total] END ASC,
  CASE @OrderBy WHEN 'TOTAL ASC' THEN s.[Total] END ASC,
  CASE @OrderBy WHEN 'USERID DESC' THEN s.[UserId] END DESC,
  CASE @OrderBy WHEN 'USERID' THEN s.[UserId] END ASC,
  CASE @OrderBy WHEN 'USERID ASC' THEN s.[UserId] END ASC
) AS RowNum
FROM
 dbo.LEDEV_LocalizationEditor_Statistics s
WHERE
 s.UserId = @UserId) AS Tbl
WHERE ((RowNum BETWEEN @StartRowIndex AND (@MaximumRows + @StartRowIndex - 1)) OR @StartRowIndex = 0)
 OR (@StartRowIndex = -1 AND (RowNum-1) % @MaximumRows = 0)
ORDER BY RowNum ASC



GO


Adding LEDEV_LocalizationEditor_GetText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetText] @TextId Int
AS 
    SELECT  *
    FROM    dbo.LEDEV_LocalizationEditor_Texts
    WHERE   [TextId] = @TextId




GO


Adding LEDEV_LocalizationEditor_GetTextByVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextByVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextByVersion]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetTextByVersion
 @ObjectId INT,
 @FilePath NVARCHAR(255),
 @TextKey NVARCHAR(255),
 @Version VARCHAR(10)
AS

SELECT
 t.*,
 '' Locale, '' TextValue, NULL AS LastModified, -1 AS LastModifiedUserId
FROM dbo.LEDEV_LocalizationEditor_Texts t
WHERE
 t.ObjectId=@ObjectId
 AND t.FilePath=@FilePath
 AND t.TextKey=@TextKey
 AND t.Version<=@Version
 AND ISNULL(t.DeprecatedIn,'99.99.99')>@Version
GO


Adding LEDEV_LocalizationEditor_GetTextsByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextsByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextsByObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetTextsByObject]
 @ModuleId Int,
 @ObjectId Int,
 @Locale NVarChar(10),
 @Version NVarChar(10)
AS 

IF @ModuleId=-1
SET @ModuleId = (SELECT ModuleId FROM dbo.LEDEV_LocalizationEditor_Objects WHERE ObjectId=@ObjectId)

SELECT  t.*,
 trans.Locale,
 trans.TextValue,
 trans.LastModified,
 trans.LastModifiedUserId
FROM dbo.LEDEV_LocalizationEditor_Texts t
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId AND trans.Locale = @Locale
 INNER JOIN 
 (SELECT t2.ObjectId, t2.FilePath, t2.TextKey, MAX(t2.[Version]) MaxVersion
  FROM dbo.LEDEV_LocalizationEditor_Texts t2
   INNER JOIN dbo.LEDEV_LocalizationEditor_Objects o2 ON o2.ObjectId=t2.ObjectId
  WHERE (o2.[ObjectId] = @ObjectId)
   AND t2.Version <= @Version
   AND (t2.DeprecatedIn IS NULL OR t2.DeprecatedIn > @Version)
  GROUP BY t2.ObjectId, t2.FilePath, t2.TextKey) lv ON lv.FilePath = t.FilePath AND lv.TextKey = t.TextKey AND lv.MaxVersion = t.[Version] AND lv.ObjectId=t.ObjectId
WHERE   t.ObjectId = @ObjectId
GO


Adding LEDEV_LocalizationEditor_GetTextsByObjectAndFile
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextsByObjectAndFile]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextsByObjectAndFile]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetTextsByObjectAndFile]
 @ModuleId Int,
 @ObjectId Int,
 @FilePath NVarChar(255),
 @Locale NVarChar(10),
 @Version NVarChar(10),
 @IncludeNonTranslated BIT
AS 

DECLARE @Locale2 VarChar(2)
SET @Locale2 = LEFT(@Locale, 2)

IF @ModuleId=-1
SET @ModuleId = (SELECT ModuleId FROM dbo.LEDEV_LocalizationEditor_Objects WHERE ObjectId=@ObjectId)

SELECT  t.*,
 ISNULL(trans.Locale, trans2.Locale) AS Locale,
 ISNULL(trans.TextValue, trans2.TextValue) AS TextValue,
 ISNULL(trans.LastModified, trans2.LastModified) AS LastModified,
 ISNULL(trans.LastModifiedUserId, trans2.LastModifiedUserId) AS LastModifiedUserId
FROM dbo.LEDEV_LocalizationEditor_Texts t
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId AND trans.Locale = @Locale
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans2 ON t.TextId = trans2.TextId AND trans2.Locale = @Locale2
 INNER JOIN 
 (SELECT t2.ObjectId, t2.FilePath, t2.TextKey, MAX(t2.[Version]) MaxVersion
  FROM dbo.LEDEV_LocalizationEditor_Texts t2
   INNER JOIN dbo.LEDEV_LocalizationEditor_Objects o2 ON o2.ObjectId=t2.ObjectId
  WHERE o2.[ObjectId] = @ObjectId
   AND t2.Version <= @Version
   AND (t2.DeprecatedIn IS NULL OR t2.DeprecatedIn > @Version)
  GROUP BY t2.ObjectId, t2.FilePath, t2.TextKey) lv ON lv.FilePath = t.FilePath AND lv.TextKey = t.TextKey AND lv.MaxVersion = t.[Version] AND lv.ObjectId=t.ObjectId
WHERE t.[FilePath] = @FilePath
 AND NOT (trans.TextValue IS NULL
  AND trans2.TextValue IS NULL
  AND @IncludeNonTranslated = 0)
GO


Adding LEDEV_LocalizationEditor_GetTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslation]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetTranslation]
 @TextId INT,
 @Locale NVARCHAR (10)
AS

SELECT
 *
FROM
 dbo.LEDEV_LocalizationEditor_Translations
WHERE
 [TextId] = @TextId
 AND [Locale] = @Locale


GO


Adding LEDEV_LocalizationEditor_GetTranslationList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationList]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetTranslationList]
 @ObjectId Int,
 @Locale NVarChar(10),
 @SourceLocale NVarChar(10),
 @Version NVarChar(10)
AS 
SELECT  t.*,
 trans.Locale,
 trans.TextValue,
 trans2.Locale AS SourceLocale,
 trans2.TextValue AS SourceValue,
 trans.LastModified,
 trans.LastModifiedUserId
FROM dbo.LEDEV_LocalizationEditor_Texts t
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans ON t.TextId = trans.TextId AND trans.Locale = @Locale
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations trans2 ON t.TextId = trans2.TextId AND trans2.Locale = @SourceLocale
 INNER JOIN (SELECT FilePath, TextKey,
  MAX([Version]) MaxVersion
   FROM   dbo.LEDEV_LocalizationEditor_Texts
   WHERE  [ObjectId] = @ObjectId
  AND [Version] <= @Version
  AND (DeprecatedIn IS NULL
   OR DeprecatedIn > @Version)
    GROUP BY FilePath,
  TextKey) lv ON lv.FilePath = t.FilePath
    AND lv.TextKey = t.TextKey
    AND lv.MaxVersion = t.[Version]
 WHERE   t.ObjectId = @ObjectId
GO


Adding LEDEV_LocalizationEditor_GetTranslationsByText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationsByText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationsByText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetTranslationsByText]
 @TextId INT,
 @StartRowIndex INT = -1,
 @MaximumRows INT = 0,
 @OrderBy VARCHAR(100) = ''
AS

SELECT * FROM
(SELECT
 t.*,
 ROW_NUMBER() OVER
 (ORDER BY
  CASE @OrderBy WHEN 'LASTMODIFIED DESC' THEN t.[LastModified] END DESC,
  CASE @OrderBy WHEN 'LASTMODIFIED' THEN t.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LASTMODIFIED ASC' THEN t.[LastModified] END ASC,
  CASE @OrderBy WHEN 'LASTMODIFIEDUSERID DESC' THEN t.[LastModifiedUserId] END DESC,
  CASE @OrderBy WHEN 'LASTMODIFIEDUSERID' THEN t.[LastModifiedUserId] END ASC,
  CASE @OrderBy WHEN 'LASTMODIFIEDUSERID ASC' THEN t.[LastModifiedUserId] END ASC,
  CASE @OrderBy WHEN 'LOCALE DESC' THEN t.[Locale] END DESC,
  CASE @OrderBy WHEN 'LOCALE' THEN t.[Locale] END ASC,
  CASE @OrderBy WHEN 'LOCALE ASC' THEN t.[Locale] END ASC,
  CASE @OrderBy WHEN 'TEXTID DESC' THEN t.[TextId] END DESC,
  CASE @OrderBy WHEN 'TEXTID' THEN t.[TextId] END ASC,
  CASE @OrderBy WHEN 'TEXTID ASC' THEN t.[TextId] END ASC,
  CASE @OrderBy WHEN 'TEXTVALUE DESC' THEN t.[TextValue] END DESC,
  CASE @OrderBy WHEN 'TEXTVALUE' THEN t.[TextValue] END ASC,
  CASE @OrderBy WHEN 'TEXTVALUE ASC' THEN t.[TextValue] END ASC
) AS RowNum
FROM
 dbo.LEDEV_LocalizationEditor_Translations t
WHERE
 t.TextId = @TextId) AS Tbl
WHERE ((RowNum BETWEEN @StartRowIndex AND (@MaximumRows + @StartRowIndex - 1)) OR @StartRowIndex = 0)
 OR (@StartRowIndex = -1 AND (RowNum-1) % @MaximumRows = 0)
ORDER BY RowNum ASC



GO


Adding LEDEV_LocalizationEditor_GetTranslationStatusByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationStatusByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationStatusByObject]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE PROCEDURE dbo.LEDEV_LocalizationEditor_GetTranslationStatusByObject
 @PortalId INT,
 @ObjectName NVARCHAR(128),
 @Version VARCHAR(10),
 @Locale VARCHAR(10)
AS 

DECLARE @LocShort VARCHAR(10)
SET @LocShort = LEFT(@Locale,2)

SELECT 
 o.ObjectId, 
 o.ObjectName, 
 o.ModuleId, 
 COUNT(tr.TextId) TextCount,
 COUNT(tr.TextId) Translated,
 MAX(tr.LastModified) LastModified
FROM dbo.LEDEV_LocalizationEditor_Objects o
 INNER JOIN dbo.LEDEV_Modules m ON m.ModuleID=o.ModuleId AND m.PortalID=@PortalId
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Texts t ON o.ObjectId=t.ObjectId AND (ISNULL(t.DeprecatedIn,'99.99.99')>@Version) AND NOT (t.OriginalValue IS NULL OR t.OriginalValue='')
 LEFT JOIN dbo.LEDEV_LocalizationEditor_Translations tr ON tr.TextId=t.TextId AND (tr.Locale=@Locale OR tr.Locale=@LocShort)
GROUP BY o.ObjectId, o.ObjectName, o.FriendlyName, o.InstallPath, o.ModuleId, o.PackageType
HAVING o.ObjectName=@ObjectName
GO


Adding LEDEV_LocalizationEditor_GetUsersFiltered
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetUsersFiltered]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetUsersFiltered]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetUsersFiltered] @filter nvarchar(256)
AS 
    BEGIN
	
        SELECT TOP 11
                Username,
                ISNULL(Email, '') As Email
        FROM    dbo.[LEDEV_Users]
        WHERE   ( PATINDEX('%@%', Email) > 0
                  AND Email LIKE '%' + @filter + '%'
                )
                OR ( Username LIKE '%' + @filter + '%'
                     OR Email LIKE '%' + @filter + '%'
                   )
        ORDER BY Username
	
    END




GO


Adding LEDEV_LocalizationEditor_GetVersions
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetVersions]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetVersions]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_GetVersions]
 @ObjectId INT
AS

SELECT DISTINCT [Version] FROM
(SELECT t.[Version]
 FROM dbo.LEDEV_LocalizationEditor_Texts t
 WHERE t.ObjectId = @ObjectId
 UNION
 SELECT p.ParentVersion AS [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
 WHERE p.ParentObjectId = @ObjectId) AS x
ORDER BY [Version]

GO


Adding LEDEV_LocalizationEditor_NrOfChangedTexts
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfChangedTexts]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfChangedTexts]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_NrOfChangedTexts]
    @ObjectId Int,
    @Version NVarChar(10)
AS 
    SELECT  COUNT(*)
    FROM    dbo.LEDEV_LocalizationEditor_Texts
    WHERE   [ObjectId] = @ObjectId
            AND [Version] = @Version




GO


Adding LEDEV_LocalizationEditor_NrOfFiles
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfFiles]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfFiles]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON




CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_NrOfFiles]
    @ObjectId Int,
    @Version NVarChar(10)
AS 
    SELECT  COUNT(*)
    FROM    ( SELECT DISTINCT
                        t.FilePath
              FROM      dbo.LEDEV_LocalizationEditor_Texts t
                        INNER JOIN ( SELECT FilePath,
                                            TextKey,
                                            MAX([Version]) MaxVersion
                                     FROM   dbo.LEDEV_LocalizationEditor_Texts
                                     WHERE  [ObjectId] = @ObjectId
                                            AND Version <= @Version
                                            AND ( DeprecatedIn IS NULL
                                                  OR DeprecatedIn > @Version
                                                )
                                     GROUP BY FilePath,
                                            TextKey
                                   ) lv ON lv.FilePath = t.FilePath
                                           AND lv.TextKey = t.TextKey
                                           AND lv.MaxVersion = t.[Version]
              WHERE     t.ObjectId = @ObjectId
            ) Total




GO


Adding LEDEV_LocalizationEditor_NrOfItems
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfItems]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfItems]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_NrOfItems]
 @ObjectId Int,
 @Version VARCHAR(10)
AS

WITH AllObjects (ObjectId, [Version])
AS (
 SELECT 
  o.ObjectId,
  @Version [Version]
 FROM dbo.LEDEV_LocalizationEditor_Objects o
 WHERE o.ObjectId=@ObjectId
 UNION ALL
 SELECT
  p.ChildObjectId,
  p.ChildVersion [Version]
 FROM dbo.LEDEV_LocalizationEditor_Packages p
  INNER JOIN AllObjects ON AllObjects.ObjectId=p.ParentObjectId AND AllObjects.[Version]=p.ParentVersion
)
SELECT SUM(x.TextCount) FROM
(SELECT *,
 (SELECT COUNT(*) FROM dbo.LEDEV_LocalizationEditor_Texts t1 
 WHERE t1.ObjectId=AllObjects.ObjectId 
  AND ISNULL(t1.DeprecatedIn, '99.99.99') > AllObjects.[Version]) AS TextCount
FROM AllObjects) AS x


GO


Adding LEDEV_LocalizationEditor_NrOfMissingTranslations
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfMissingTranslations]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfMissingTranslations]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON





CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_NrOfMissingTranslations]
    @ObjectId Int,
    @Locale NVarChar(10),
    @Version NVarChar(10)
AS

DECLARE @TotTrans INT
SET @TotTrans = (SELECT COUNT(*) FROM dbo.LEDEV_LocalizationEditor_Texts t1 
 WHERE t1.ObjectId=@ObjectId 
  AND ISNULL(t1.DeprecatedIn, '99.99.99') > @Version)

DECLARE @Trans INT
SET @Trans = (SELECT COUNT(*) FROM dbo.LEDEV_LocalizationEditor_Texts t2 
 INNER JOIN dbo.LEDEV_LocalizationEditor_Translations t3 ON t3.TextId=t2.TextId AND t3.Locale=@Locale
 WHERE t2.ObjectId=@ObjectId 
  AND ISNULL(t2.DeprecatedIn, '99.99.99') > @Version)

SELECT @TotTrans-@Trans





GO


Adding LEDEV_LocalizationEditor_RegisterPackageItem
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_RegisterPackageItem]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_RegisterPackageItem]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON


CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_RegisterPackageItem]
 @ParentObjectId INT, 
 @ParentVersion VARCHAR (10),
 @ChildObjectId INT, 
 @ChildVersion VARCHAR (10)
AS

IF EXISTS(SELECT * FROM
 dbo.LEDEV_LocalizationEditor_Packages
 WHERE
  [ParentObjectId] = @ParentObjectId
  AND [ParentVersion] = @ParentVersion
  AND [ChildObjectId] = @ChildObjectId
)
 UPDATE dbo.LEDEV_LocalizationEditor_Packages SET
  [ChildVersion] = @ChildVersion
 WHERE
  [ParentObjectId] = @ParentObjectId
  AND [ParentVersion] = @ParentVersion
  AND [ChildObjectId] = @ChildObjectId
ELSE
 INSERT INTO dbo.LEDEV_LocalizationEditor_Packages (
  [ChildObjectId],
  [ChildVersion],
  [ParentObjectId],
  [ParentVersion])
 VALUES (
  @ChildObjectId,
  @ChildVersion,
  @ParentObjectId,
  @ParentVersion)

GO


Adding LEDEV_LocalizationEditor_SetStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_SetStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_SetStatistic]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_SetStatistic]
 @Locale NVARCHAR (10), 
 @TextId INT, 
 @Total INT, 
 @UserId INT
AS

IF EXISTS(SELECT
  *
 FROM
  dbo.LEDEV_LocalizationEditor_Statistics
 WHERE
  [TextId] = @TextId
  AND [Locale] = @Locale
  AND [UserId] = @UserId)
 UPDATE dbo.LEDEV_LocalizationEditor_Statistics SET
  [Total] = @Total
 WHERE
  [TextId] = @TextId
  AND [Locale] = @Locale
  AND [UserId] = @UserId
ELSE
 INSERT INTO dbo.LEDEV_LocalizationEditor_Statistics (
  [Locale],
  [TextId],
  [Total],
  [UserId])
 VALUES (
  @Locale,
  @TextId,
  @Total,
  @UserId)



GO


Adding LEDEV_LocalizationEditor_SetTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_SetTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_SetTranslation]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_SetTranslation]
 @LastModified DATETIME, 
 @LastModifiedUserId INT, 
 @Locale NVARCHAR (10), 
 @TextId INT, 
 @TextValue NVARCHAR (MAX)
AS

IF EXISTS(SELECT
  *
 FROM
  dbo.LEDEV_LocalizationEditor_Translations
 WHERE
  [TextId] = @TextId
  AND [Locale] = @Locale)
UPDATE dbo.LEDEV_LocalizationEditor_Translations SET
 [LastModified] = @LastModified,
 [LastModifiedUserId] = @LastModifiedUserId,
 [TextValue] = @TextValue
WHERE
 [TextId] = @TextId
 AND [Locale] = @Locale
ELSE
 INSERT INTO dbo.LEDEV_LocalizationEditor_Translations (
  [LastModified],
  [LastModifiedUserId],
  [Locale],
  [TextId],
  [TextValue])
 VALUES (
  @LastModified,
  @LastModifiedUserId,
  @Locale,
  @TextId,
  @TextValue)


GO


Adding LEDEV_LocalizationEditor_UpdatePartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdatePartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdatePartner]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_UpdatePartner]
 @AllowDirectDownload BIT, 
 @ModuleId INT, 
 @AllowRedistribute BIT, 
 @CubeUrl NVARCHAR (300), 
 @DownloadAffiliates BIT, 
 @LastCube NVARCHAR (MAX), 
 @PackUrl NVARCHAR (300), 
 @PartnerId INT, 
 @PartnerName NVARCHAR (100), 
 @PartnerUrl NVARCHAR (300), 
 @PartnerUsername NCHAR (50)
AS

UPDATE dbo.LEDEV_LocalizationEditor_Partners SET
 [AllowDirectDownload] = @AllowDirectDownload,
 [ModuleId] = @ModuleId,
 [AllowRedistribute] = @AllowRedistribute,
 [CubeUrl] = @CubeUrl,
 [DownloadAffiliates] = @DownloadAffiliates,
 [LastCube] = @LastCube,
 [PackUrl] = @PackUrl,
 [PartnerName] = @PartnerName,
 [PartnerUrl] = @PartnerUrl,
 [PartnerUsername] = @PartnerUsername
WHERE
 [PartnerId] = @PartnerId


GO


Adding LEDEV_LocalizationEditor_UpdatePartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdatePartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdatePartnerPack]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdatePartnerPack]
 @LastModified DATETIME, 
 @Locale NVARCHAR(10), 
 @ObjectId INT, 
 @PartnerId INT, 
 @PercentComplete REAL, 
 @RemoteObjectId INT, 
 @Version NVARCHAR(10)
AS

UPDATE dbo.LEDEV_LocalizationEditor_PartnerPacks SET
 [LastModified] = @LastModified,
 [PercentComplete] = @PercentComplete,
 [RemoteObjectId] = @RemoteObjectId
WHERE
 [PartnerId] = @PartnerId
 AND [ObjectId] = @ObjectId
 AND [Version] = @Version
 AND [Locale] = @Locale


GO


Adding LEDEV_LocalizationEditor_UpdateText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdateText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdateText]
GO


SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON



CREATE PROCEDURE dbo.[LEDEV_LocalizationEditor_UpdateText]
 @DeprecatedIn NVARCHAR (10), 
 @FilePath NVARCHAR (255), 
 @ObjectId INT, 
 @OriginalValue NVARCHAR (MAX), 
 @TextId INT, 
 @TextKey NVARCHAR (255), 
 @Version NVARCHAR (10)
AS

UPDATE dbo.LEDEV_LocalizationEditor_Texts SET
 [DeprecatedIn] = @DeprecatedIn,
 [FilePath] = @FilePath,
 [ObjectId] = @ObjectId,
 [OriginalValue] = @OriginalValue,
 [TextKey] = @TextKey,
 [Version] = @Version
WHERE
 [TextId] = @TextId


GO


Finished Script Creation
Loaded E:\Webroot\LEDEV\web.config
ConnectionString: Server=(local);Database=LEDEV;uid=test;pwd=test;
ObjectQualifier : LEDEV_
DatabaseOwner   : dbo
FullPattern     : (?<owner>\[?dbo\]?\.)?\[?(?<prefix>\w*)(?<dnnqualifier>LEDEV_)(?<modqualifier>LocalizationEditor_)(?<name>\w+)\]?|(?<owner>\[?dbo\]?\.)\[?(?<prefix>\w*)(?<dnnqualifier>LEDEV_)(?<modqualifier>LocalizationEditor_)?(?<name>\w+)\]?|\[?(?<dnnqualifier>LEDEV_)(?<name>\w+)\]?

Create Uninstall Script
SPROCS
Adding LEDEV_LocalizationEditor_AddObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddObject]
GO


Adding LEDEV_LocalizationEditor_AddPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPartner]
GO


Adding LEDEV_LocalizationEditor_AddPartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPartnerPack]
GO


Adding LEDEV_LocalizationEditor_AddPermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddPermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddPermission]
GO


Adding LEDEV_LocalizationEditor_AddText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_AddText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_AddText]
GO


Adding LEDEV_LocalizationEditor_CurrentVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_CurrentVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_CurrentVersion]
GO


Adding LEDEV_LocalizationEditor_DeleteObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteObject]
GO


Adding LEDEV_LocalizationEditor_DeletePartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartner]
GO


Adding LEDEV_LocalizationEditor_DeletePartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPack]
GO


Adding LEDEV_LocalizationEditor_DeletePartnerPacksByPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePartnerPacksByPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePartnerPacksByPartner]
GO


Adding LEDEV_LocalizationEditor_DeletePermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeletePermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeletePermission]
GO


Adding LEDEV_LocalizationEditor_DeleteStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteStatistic]
GO


Adding LEDEV_LocalizationEditor_DeleteText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteText]
GO


Adding LEDEV_LocalizationEditor_DeleteTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_DeleteTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_DeleteTranslation]
GO


Adding LEDEV_LocalizationEditor_FindText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_FindText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_FindText]
GO


Adding LEDEV_LocalizationEditor_GetAllPartners
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetAllPartners]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetAllPartners]
GO


Adding LEDEV_LocalizationEditor_GetContributorList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetContributorList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetContributorList]
GO


Adding LEDEV_LocalizationEditor_GetCube
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetCube]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetCube]
GO


Adding LEDEV_LocalizationEditor_GetDependentTextsForObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetDependentTextsForObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetDependentTextsForObject]
GO


Adding LEDEV_LocalizationEditor_GetFiles
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetFiles]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetFiles]
GO


Adding LEDEV_LocalizationEditor_GetFrameworkVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetFrameworkVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetFrameworkVersion]
GO


Adding LEDEV_LocalizationEditor_GetLanguagePacks
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLanguagePacks]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLanguagePacks]
GO


Adding LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLanguagePacksByObjectVersionLocale]
GO


Adding LEDEV_LocalizationEditor_GetLastEditTime
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLastEditTime]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLastEditTime]
GO


Adding LEDEV_LocalizationEditor_GetLatestText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLatestText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLatestText]
GO


Adding LEDEV_LocalizationEditor_GetLocales
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLocales]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLocales]
GO


Adding LEDEV_LocalizationEditor_GetLocalesForUser
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetLocalesForUser]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetLocalesForUser]
GO


Adding LEDEV_LocalizationEditor_GetModuleForObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetModuleForObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetModuleForObject]
GO


Adding LEDEV_LocalizationEditor_GetObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObject]
GO


Adding LEDEV_LocalizationEditor_GetObjectByObjectName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectByObjectName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectByObjectName]
GO


Adding LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectByObjectNameAndModuleKey]
GO


Adding LEDEV_LocalizationEditor_GetObjectPackList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectPackList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectPackList]
GO


Adding LEDEV_LocalizationEditor_GetObjects
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjects]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjects]
GO


Adding LEDEV_LocalizationEditor_GetObjectsByObjectName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsByObjectName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsByObjectName]
GO


Adding LEDEV_LocalizationEditor_GetObjectsByPackage
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsByPackage]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsByPackage]
GO


Adding LEDEV_LocalizationEditor_GetObjectsWithStatus
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectsWithStatus]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectsWithStatus]
GO


Adding LEDEV_LocalizationEditor_GetObjectVersionList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetObjectVersionList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetObjectVersionList]
GO


Adding LEDEV_LocalizationEditor_GetOldestText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetOldestText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetOldestText]
GO


Adding LEDEV_LocalizationEditor_GetPackStatistics
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPackStatistics]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPackStatistics]
GO


Adding LEDEV_LocalizationEditor_GetParentObjects
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetParentObjects]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetParentObjects]
GO


Adding LEDEV_LocalizationEditor_GetPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartner]
GO


Adding LEDEV_LocalizationEditor_GetPartnerByName
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerByName]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerByName]
GO


Adding LEDEV_LocalizationEditor_GetPartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPack]
GO


Adding LEDEV_LocalizationEditor_GetPartnerPacksByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByObject]
GO


Adding LEDEV_LocalizationEditor_GetPartnerPacksByPartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByPartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnerPacksByPartner]
GO


Adding LEDEV_LocalizationEditor_GetPartnersByModule
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPartnersByModule]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPartnersByModule]
GO


Adding LEDEV_LocalizationEditor_GetPermission
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermission]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermission]
GO


Adding LEDEV_LocalizationEditor_GetPermissionById
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermissionById]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissionById]
GO


Adding LEDEV_LocalizationEditor_GetPermissions
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetPermissions]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetPermissions]
GO


Adding LEDEV_LocalizationEditor_GetStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetStatistic]
GO


Adding LEDEV_LocalizationEditor_GetStatisticsByUser
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetStatisticsByUser]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetStatisticsByUser]
GO


Adding LEDEV_LocalizationEditor_GetText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetText]
GO


Adding LEDEV_LocalizationEditor_GetTextByVersion
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextByVersion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextByVersion]
GO


Adding LEDEV_LocalizationEditor_GetTextsByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextsByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextsByObject]
GO


Adding LEDEV_LocalizationEditor_GetTextsByObjectAndFile
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTextsByObjectAndFile]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTextsByObjectAndFile]
GO


Adding LEDEV_LocalizationEditor_GetTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslation]
GO


Adding LEDEV_LocalizationEditor_GetTranslationList
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationList]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationList]
GO


Adding LEDEV_LocalizationEditor_GetTranslationsByText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationsByText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationsByText]
GO


Adding LEDEV_LocalizationEditor_GetTranslationStatusByObject
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationStatusByObject]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetTranslationStatusByObject]
GO


Adding LEDEV_LocalizationEditor_GetUsersFiltered
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetUsersFiltered]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetUsersFiltered]
GO


Adding LEDEV_LocalizationEditor_GetVersions
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetVersions]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_GetVersions]
GO


Adding LEDEV_LocalizationEditor_NrOfChangedTexts
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfChangedTexts]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfChangedTexts]
GO


Adding LEDEV_LocalizationEditor_NrOfFiles
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfFiles]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfFiles]
GO


Adding LEDEV_LocalizationEditor_NrOfItems
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfItems]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfItems]
GO


Adding LEDEV_LocalizationEditor_NrOfMissingTranslations
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_NrOfMissingTranslations]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_NrOfMissingTranslations]
GO


Adding LEDEV_LocalizationEditor_RegisterPackageItem
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_RegisterPackageItem]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_RegisterPackageItem]
GO


Adding LEDEV_LocalizationEditor_SetStatistic
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_SetStatistic]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_SetStatistic]
GO


Adding LEDEV_LocalizationEditor_SetTranslation
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_SetTranslation]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_SetTranslation]
GO


Adding LEDEV_LocalizationEditor_UpdatePartner
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdatePartner]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdatePartner]
GO


Adding LEDEV_LocalizationEditor_UpdatePartnerPack
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdatePartnerPack]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdatePartnerPack]
GO


Adding LEDEV_LocalizationEditor_UpdateText
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_UpdateText]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[LEDEV_LocalizationEditor_UpdateText]
GO


VIEWS
Adding LEDEV_vw_LocalizationEditor_Objects
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_Objects]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_Objects]
GO


Adding LEDEV_vw_LocalizationEditor_ObjectVersions
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_ObjectVersions]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_ObjectVersions]
GO


Adding LEDEV_vw_LocalizationEditor_Permissions
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_vw_LocalizationEditor_Permissions]'))
DROP VIEW [dbo].[LEDEV_vw_LocalizationEditor_Permissions]
GO


FUNCTIONS
Adding LEDEV_LocalizationEditor_GetTranslationStatus
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_GetTranslationStatus]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
DROP FUNCTION [dbo].[LEDEV_LocalizationEditor_GetTranslationStatus]
GO


TRIGGERS
STRUCTURE
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Packages_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Packages]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Packages] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Packages_Objects]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Objects]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_PartnerPacks_Partners]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_PartnerPacks_Partners]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Partners_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Partners]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Partners] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Partners_Modules]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Modules]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Modules]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Permissions_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Permissions] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Permissions_Users]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Texts]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Statistics_Users]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Statistics] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Statistics_Users]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Texts_Objects]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Texts]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Texts] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Texts_Objects]
GO


IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEDEV_LocalizationEditor_Translations_Texts]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Translations]'))
ALTER TABLE [dbo].[LEDEV_LocalizationEditor_Translations] DROP CONSTRAINT [FK_LEDEV_LocalizationEditor_Translations_Texts]
GO


TABLES
Adding LEDEV_LocalizationEditor_Objects
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Objects]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Objects]
GO


Adding LEDEV_LocalizationEditor_Packages
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Packages]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Packages]
GO


Adding LEDEV_LocalizationEditor_PartnerPacks
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_PartnerPacks]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_PartnerPacks]
GO


Adding LEDEV_LocalizationEditor_Partners
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Partners]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Partners]
GO


Adding LEDEV_LocalizationEditor_Permissions
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Permissions]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Permissions]
GO


Adding LEDEV_LocalizationEditor_Statistics
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Statistics]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Statistics]
GO


Adding LEDEV_LocalizationEditor_Texts
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Texts]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Texts]
GO


Adding LEDEV_LocalizationEditor_Translations
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEDEV_LocalizationEditor_Translations]') AND type in (N'U'))
DROP TABLE [dbo].[LEDEV_LocalizationEditor_Translations]
GO


Finished Script Creation

BUILD SUCCEEDED

Total time: 2.5 seconds.

